# NeuroChatBot 💬

Telegram-бот на C\# (.NET), предоставляющий гибкий интерфейс для общения с различными большими языковыми моделями (LLM), такими как Llama.cpp, Oobabooga's Text Generation Web UI и другие, через их API. Проект разработан с использованием принципов чистой архитектуры, обеспечивая простоту расширения, управления пользователями и историей чатов с помощью MongoDB.

## 🌟 Особенности

  * **Гибкое подключение к LLM:** Легко интегрируется с различными LLM-серверами, предоставляющими API-интерфейсы (например, `llama.cpp` в режиме сервера, Oobabooga's Text Generation Web UI). Просто укажите адрес вашего LLM-сервера в файле `.env`.
  * **Управление несколькими персонажами:** Пользователи могут создавать и переключаться между различными AI-персонажами, каждый со своим уникальным промптом, именем и приветствием.
  * **Динамические чаты:** Поддержка сохранения истории чатов для каждого персонажа, позволяющая LLM поддерживать контекст диалога.
  * **Персонализация пользователя:** Возможность задавать имя пользователя и пользовательское описание, которое будет передаваться в LLM для более релевантных ответов.
  * **Чистая архитектура:** Проект следует принципам чистой архитектуры, что делает его модульным, тестируемым и легко расширяемым. Логика разделена на слои: Core, Models, Services.
  * **Конфигурация через `.env`:** Все чувствительные данные (токен бота, строка подключения к БД, адрес LLM-сервера) хранятся в файле `.env`, обеспечивая безопасность и удобство развертывания.
  * **Сохранение данных в MongoDB:** Данные пользователей, их персонажи и история чатов надежно сохраняются в базе данных MongoDB.
  * **Интуитивный Telegram-интерфейс:** Удобное меню команд для управления настройками, персонажами и чатами.

## 🚀 Начало работы

Эти инструкции помогут вам настроить и запустить проект на вашей локальной машине.

### Необходимые условия

  * [.NET SDK 8.0](https://dotnet.microsoft.com/download/dotnet/8.0) или выше
  * [MongoDB](https://www.mongodb.com/try/download/community) (локальный или удаленный экземпляр)
  * Работающий LLM-сервер с API (например, `llama.cpp` в режиме сервера, Oobabooga's Text Generation Web UI и т.д.). Убедитесь, что он доступен по сети.
  * [Токен Telegram Bot API](https://www.google.com/search?q=https://core.telegram.org/bots/api%23getting-updates) (получить у @BotFather в Telegram)

### Установка

1.  **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/alex-pyslar/NeuroChatBot.git
    cd NeuroChatBot
    ```

2.  **Установите NuGet-пакеты:**

    ```bash
    dotnet restore
    ```

    (или `dotnet add package <PackageName>` для каждого пакета, если restore не работает автоматически. Основные пакеты: `Telegram.Bot`, `MongoDB.Driver`, `Microsoft.Extensions.Configuration.*`, `Microsoft.Extensions.DependencyInjection`, `Microsoft.Extensions.Http`, `DotEnv.Core`, `System.Net.Http.Json`)

3.  **Создайте файл `.env`:**
    В корневой директории проекта (там же, где `Program.cs` и `.csproj`) создайте файл с именем `.env` и добавьте в него следующие переменные:

    ```env
    TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН_ТЕЛЕГРАМ_БОТА"
    MONGO_CONNECTION_STRING="mongodb://ВАШ_ПОЛЬЗОВАТЕЛЬ:ВАШ_ПАРОЛЬ@ВАШ_ХОСТ:ВАШ_ПОРТ/ВАША_БАЗА_ДАННЫХ?authSource=admin"
    MONGO_DATABASE_NAME="NeuroChatBotDB"
    LLAMA_SERVER_ADDRESS="http://ВАШ_LLM_СЕРВЕР_IP:ПОРТ"
    ```

    *Замените плейсхолдеры (`ВАШ_ТОКЕН_...`, `ВАШ_ПОЛЬЗОВАТЕЛЬ` и т.д.) на ваши актуальные данные.*
    **ВАЖНО:** Никогда не коммитьте ваш `.env` файл в Git\! Добавьте его в `.gitignore`.

### Запуск

После настройки выполните команду для запуска проекта:

```bash
dotnet run
```

Бот запустится и начнет принимать сообщения. Откройте Telegram и отправьте `/start` вашему боту.

## 🛠 Архитектура проекта

Проект разработан с учетом принципов чистой архитектуры (Clean Architecture), что обеспечивает четкое разделение обязанностей и упрощает масштабирование и поддержку.

  * **`NeuroChatBot/`**
      * **`Program.cs`**: Точка входа в приложение, настройка зависимостей (DI) и запуск Telegram-бота.
      * **`Core/`**: Содержит базовые интерфейсы и классы, такие как `ILogger` и `ConsoleLogger`.
      * **`Models/`**: Определяет структуры данных, используемые в приложении (например, `User`, `CharacterPreset`, `ChatMessage`, модели для API-ответов LLM).
      * **`Services/`**: Содержит бизнес-логику и сервисы, инкапсулирующие взаимодействие с внешними системами:
          * `IMongoDbService` / `MongoDbService`: Работа с базой данных MongoDB.
          * `IUserService` / `MongoDbUserService`: Управление пользователями и их данными.
          * `IModelService` / `LlamaCppModelService`: Взаимодействие с LLM-сервером.
          * `TelegramBotService`: Основная логика Telegram-бота, обработка сообщений и команд.

## 🤝 Контрибьюция

Мы приветствуем любые вклады в развитие проекта\! Если у вас есть идеи, предложения или вы нашли ошибку, пожалуйста:

1.  Форкните репозиторий.
2.  Создайте новую ветку (`git checkout -b feature/AmazingFeature`).
3.  Внесите свои изменения и закоммитьте их (`git commit -m 'Add some AmazingFeature'`).
4.  Отправьте изменения на удаленный репозиторий (`git push origin feature/AmazingFeature`).
5.  Откройте Pull Request.

## 📄 Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](https://www.google.com/search?q=LICENSE).